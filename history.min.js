!function(e){"function"==typeof define&&define.amd?define("history",[],e):e()}(function(){function e(){}function t(e,n,r){var a=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/;if(null==e||""===e||n)e=n?e:x.href,(!$||r)&&(e=e.replace(/^[^#]*/,"")||"#",e=x.protocol.replace(/:.*$|$/,":")+"//"+x.host+U.basepath+e.replace(new RegExp("^#[/]?(?:"+U.type+")?"),""));else{var i=t(),o=y.getElementsByTagName("base")[0];!r&&o&&o.getAttribute("href")&&(o.href=o.href,i=t(o.href,null,!0));var c=i._pathname,l=i._protocol;e=""+e,e=/^(?:\w+\:)?\/\//.test(e)?0===e.indexOf("/")?l+e:e:l+"//"+i._host+(0===e.indexOf("/")?e:0===e.indexOf("?")?c+e:0===e.indexOf("#")?c+i._search+e:c.replace(/[^\/]+$/g,"")+e)}D.href=e;var s=a.exec(D.href),f=s[2]+(s[3]?":"+s[3]:""),u=s[4]||"/",p=s[5]||"",h="#"===s[6]?"":s[6]||"",v=u+p+h,g=u.replace(new RegExp("^"+U.basepath,"i"),U.type)+p;return{_href:s[1]+"//"+f+v,_protocol:s[1],_host:f,_hostname:s[2],_port:s[3]||"",_pathname:u,_search:p,_hash:h,_relative:v,_nohash:g,_special:g+h}}function n(){var e;try{e=d.sessionStorage,e.setItem(V+"t","1"),e.removeItem(V+"t")}catch(t){e={getItem:function(e){var t=y.cookie.split(e+"=");return t.length>1&&t.pop().split(";").shift()||"null"},setItem:function(e,t){var n={};(n[x.href]=w.state)&&(y.cookie=e+"="+b.stringify(n))}}}try{H=b.parse(e.getItem(V))||{}}catch(t){H={}}k(N+"unload",function(){e.setItem(V,b.stringify(H))},!1)}function r(t,n,r,a){var i=0;r||(r={set:e},i=1);var o=!r.set,c=!r.get,l={configurable:!0,set:function(){o=1},get:function(){c=1}};try{L(t,n,l),t[n]=t[n],L(t,n,r)}catch(s){}if(!(o&&c||(t.__defineGetter__&&(t.__defineGetter__(n,l.get),t.__defineSetter__(n,l.set),t[n]=t[n],r.get&&t.__defineGetter__(n,r.get),r.set&&t.__defineSetter__(n,r.set)),o&&c))){if(i)return!1;if(t===d){try{var f=t[n];t[n]=null}catch(s){}if("execScript"in d)d.execScript("Public "+n,"VBScript"),d.execScript("var "+n+";","JavaScript");else try{L(t,n,{value:e})}catch(s){"onpopstate"===n&&(k("popstate",r=function(){j("popstate",r,!1);var e=t.onpopstate;t.onpopstate=null,setTimeout(function(){t.onpopstate=e},1)},!1),q=0)}t[n]=f}else try{try{var u=E.create(t);L(E.getPrototypeOf(u)===t?u:t,n,r);for(var p in t)"function"==typeof t[p]&&(u[p]=t[p].bind(t));try{a.call(u,u,t)}catch(s){}t=u}catch(s){L(t.constructor.prototype,n,r)}}catch(s){return!1}}return t}function a(e,t,n){return n=n||{},e=e===Y?x:e,n.set=n.set||function(n){e[t]=n},n.get=n.get||function(){return e[t]},n}function i(e,t,n){e in K?K[e].push(t):arguments.length>3?k(e,t,n,arguments[3]):k(e,t,n)}function o(e,t,n){var r=K[e];if(r){for(var a=r.length;a--;)if(r[a]===t){r.splice(a,1);break}}else j(e,t,n)}function c(t,n){var a=(""+("string"==typeof t?t:t.type)).replace(/^on/,""),i=K[a];if(i){if(n="string"==typeof t?n:t,null==n.target)for(var o=["target","currentTarget","srcElement","type"];t=o.pop();)n=r(n,t,{get:"type"===t?function(){return a}:function(){return d}});q&&(("popstate"===a?d.onpopstate:d.onhashchange)||e).call(d,n);for(var c=0,l=i.length;l>c;c++)i[c].call(d,n);return!0}return G(t,n)}function l(){var e=y.createEvent?y.createEvent("Event"):y.createEventObject();e.initEvent?e.initEvent("popstate",!1,!1):e.type="popstate",e.state=w.state,c(e)}function s(){z&&(z=!1,l())}function f(e,n,r,a){if($)J=x.href;else{0===F&&(F=2);var i=t(n,2===F&&-1!==(""+n).indexOf("#"));i._relative!==t()._relative&&(J=a,r?x.replace("#"+i._special):x.hash=i._special)}!I&&e&&(H[x.href]=e),z=!1}function u(e){var n=J;if(J=x.href,n){C!==x.href&&l(),e=e||d.event;var r=t(n,!0),a=t();e.oldURL||(e.oldURL=r._href,e.newURL=a._href),r._hash!==a._hash&&c(e)}}function p(e){setTimeout(function(){k("popstate",function(e){C=x.href,I||(e=r(e,"state",{get:function(){return w.state}})),c(e)},!1)},0),!$&&e!==!0&&"location"in w&&(g(T.hash),s())}function h(e){for(;e;){if("A"===e.nodeName)return e;e=e.parentNode}}function v(e){var n=e||d.event,r=h(n.target||n.srcElement),a="defaultPrevented"in n?n.defaultPrevented:n.returnValue===!1;if(r&&"A"===r.nodeName&&!a){var i=t(),o=t(r.getAttribute("href",2)),c=i._href.split("#").shift()===o._href.split("#").shift();c&&o._hash&&(i._hash!==o._hash&&(T.hash=o._hash),g(o._hash),n.preventDefault?n.preventDefault():n.returnValue=!1)}}function g(e){var t=y.getElementById(e=(e||"").replace(/^#/,""));if(t&&t.id===e&&"A"===t.nodeName){var n=t.getBoundingClientRect();d.scrollTo(m.scrollLeft||0,n.top+(m.scrollTop||0)-(m.clientTop||0))}}function _(){var e=y.getElementsByTagName("script"),i=(e[e.length-1]||{}).src||"",o=-1!==i.indexOf("?")?i.split("?").pop():"";o.replace(/(\w+)(?:=([^&]*))?/g,function(e,t,n){U[t]=(n||"").replace(/^(0|false)$/,"")}),k(N+"hashchange",u,!1);var c=[Y,T,Q,d,X,w];I&&delete X.state;for(var l=0;l<c.length;l+=2)for(var s in c[l])if(c[l].hasOwnProperty(s))if("function"==typeof c[l][s])c[l+1][s]=c[l][s];else{var f=a(c[l],s,c[l][s]);if(!r(c[l+1],s,f,function(e,t){t===w&&(d.history=w=c[l+1]=e)}))return j(N+"hashchange",u,!1),!1;c[l+1]===d&&(K[s]=K[s.substr(2)]=[])}return w.setup(),U.redirect&&w.redirect(),U.init&&(F=1),!I&&b&&n(),$||y[P](N+"click",v,!1),"complete"===y.readyState?p(!0):($||t()._relative===U.basepath||(z=!0),k(N+"load",p,!1)),!0}var d=("object"==typeof window?window:this)||{};if(!d.history||"emulate"in d.history)return d.history;var y=d.document,m=y.documentElement,E=d.Object,b=d.JSON,x=d.location,S=d.history,w=S,O=S.pushState,R=S.replaceState,$=!!O,I="state"in S,L=E.defineProperty,T=r({},"t")?{}:y.createElement("a"),N="",P=d.addEventListener?"addEventListener":(N="on")&&"attachEvent",A=d.removeEventListener?"removeEventListener":"detachEvent",B=d.dispatchEvent?"dispatchEvent":"fireEvent",k=d[P],j=d[A],G=d[B],U={basepath:"/",redirect:0,type:"/",init:0},V="__historyAPI__",D=y.createElement("a"),J=x.href,C="",q=1,z=!1,F=0,H={},K={},M=y.title,Q={onhashchange:null,onpopstate:null},W=function(e,t){var n=d.history!==S;n&&(d.history=S),e.apply(S,t),n&&(d.history=w)},X={setup:function(e,t,n){U.basepath=(""+(null==e?U.basepath:e)).replace(/(?:^|\/)[^\/]*$/,"/"),U.type=null==t?U.type:t,U.redirect=null==n?U.redirect:!!n},redirect:function(e,n){if(w.setup(n,e),n=U.basepath,d.top==d.self){var r=t(null,!1,!0)._relative,a=x.pathname+x.search;$?(a=a.replace(/([^\/])$/,"$1/"),r!=n&&new RegExp("^"+n+"$","i").test(a)&&x.replace(r)):a!=n&&(a=a.replace(/([^\/])\?/,"$1/?"),new RegExp("^"+n,"i").test(a)&&x.replace(n+"#"+a.replace(new RegExp("^"+n,"i"),U.type)+x.hash))}},pushState:function(e,t,n){var r=y.title;null!=M&&(y.title=M),O&&W(O,arguments),f(e,n),y.title=r,M=t},replaceState:function(e,t,n){var r=y.title;null!=M&&(y.title=M),delete H[x.href],R&&W(R,arguments),f(e,n,!0),y.title=r,M=t},location:{set:function(e){0===F&&(F=1),d.location=e},get:function(){return 0===F&&(F=1),$?x:T}},state:{get:function(){return H[x.href]||null}}},Y={assign:function(e){0===(""+e).indexOf("#")?f(null,e):x.assign(e)},reload:function(){x.reload()},replace:function(e){0===(""+e).indexOf("#")?f(null,e,!0):x.replace(e)},toString:function(){return this.href},href:{get:function(){return t()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return t()._pathname}},search:{get:function(){return t()._search}},hash:{set:function(e){f(null,(""+e).replace(/^(#|)/,"#"),!1,J)},get:function(){return t()._hash}}};return _()?(w.emulate=!$,d[P]=i,d[A]=o,d[B]=c,w):void 0});